---
title: "Jotaiã§Atomã®æŒ™å‹•ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "jotai", "jest"]
published: false
---

Jotaiã‚’ç”¨ã„ã¦Reacté–‹ç™ºã—ã¦ã„ã‚‹éš›ã€ä½œã£ãŸAtomã®æŒ™å‹•ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„ã“ã¨ãŒã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚èª¿ã¹ã¦ã¿ã‚‹ã¨æ€ã„ã®å¤–å‚è€ƒã«ãªã‚‹æƒ…å ±ãŒç„¡ã‹ã£ãŸã®ã§ã€ç°¡å˜ãªãƒ†ã‚¹ãƒˆæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ãƒ­ã‚¸ãƒƒã‚¯éƒ¨åˆ†ã‚’åˆ¥é–¢æ•°ã«åˆ‡ã‚Šåˆ†ã‘ã€ãã®é–¢æ•°å˜ä½“ã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã†æ–¹é‡ã‚‚è€ƒãˆã‚‰ã‚Œã¾ã™ã®ã§ã€ãã¡ã‚‰ã‚’æ¤œè¨ã—ã¦ã¿ã‚‹ã®ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

# ãƒ†ã‚¹ãƒˆæ–¹æ³•

`store`ã®`get`ãƒ¡ã‚½ãƒƒãƒ‰ã‚„`set`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦ãƒ†ã‚¹ãƒˆã‚’ç”¨ã„ã‚‹ã®ãŒè‰¯ã„ã§ã™ã€‚`useAtom`ãƒ»`useAtomValue`ãƒ»`useSetValue`ãªã©ã¯Hookãªã®ã§åŸºæœ¬çš„ã«ã¯Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ä½¿ç”¨ã—ã¾ã™ã€‚ãã®ãŸã‚ã€AtomãŒã¡ã‚ƒã‚“ã¨å€¤ã‚’è¨ˆç®—ã—ã¦ãã‚Œã‚‹ã‹ãªã©ã‚’Jestã§ãŠæ‰‹è»½ã«ãƒ†ã‚¹ãƒˆã™ã‚‹ã®ã«ã¯å‘ãã¾ã›ã‚“ã€‚

Jotaiã«ãŠã„ã¦Atomã¯å¤§ããåˆ†ã‘ã¦2ã¤ã‚ã‚Šã¾ã™ã€‚**primitive atom**ã¨**derived atom**ã§ã™ã€‚derived atomã¯primitive atomã‚’ç”¨ã„ã¦è¨ˆç®—ã•ã‚Œã‚‹atomã«ãªã‚Šã¾ã™ï¼ˆRecoilã®selectorã«è¿‘ã„ã‹ã‚‚ï¼‰ã€‚derived atomã¯ä»¥ä¸‹ã®3ã¤ã«åŒºåˆ†å‡ºæ¥ã¾ã™ã€‚

- Read-only Atom
- Write-only Atom
- Read-Write Atom

ãƒ†ã‚¹ãƒˆã®è¦³ç‚¹ã‹ã‚‰è¨€ã†ã¨Read-Write Atomã¯å…ˆ2ã¤ã¨åŒã˜ãªã®ã§ã“ã®è¨˜äº‹ã§ã¯å‰²æ„›ã—ã¾ã™ã€‚

## Read-only Atomã®ãƒ†ã‚¹ãƒˆ

Read-only Atomã¯Atomã®å€¤ã‚’èª­ã¿å–ã‚‹Atomã§ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®`doubledNumberAtom`ã¯read-only atomã§ã™ã€‚

```ts
const numberAtom = atom(0); // primitive atom

const doubledNumberAtom = atom((get) => get(numberAtom) * 2);
```

ã“ã®Atomã¯`store`ã‚’ç”¨ã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```ts
test("should add 1", () => {
  const store = createStore();
  store.set(numberAtom, 1); // numberAtomã®åˆæœŸå€¤ã‚’è¨­å®š
  const newNumber = store.get(doubledNumberAtom); // doubledNumberAtomã®å€¤ã‚’èª­ã¿å‡ºã™

  expect(newNumber).toBe(2);
})
```

## Write-only Atomã®ãƒ†ã‚¹ãƒˆ

Write-only Atomã¯æ–‡å­—é€šã‚ŠAtomã®å€¤ã‚’æ›´æ–°ã™ã‚‹ã ã‘ã®Atomã§ã™ã€‚ã‚‚ã¡ã‚ã‚“readã™ã‚‹ã“ã¨ã¯å‡ºæ¥ã¾ã›ã‚“ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªWrite-only Atomã‚’è€ƒãˆã¾ã™ã€‚

```ts
const numberAtom = atom(0); // primitive atom

const addNumberAtom = atom(
  null,
  (get, set, num: number) => set(numberAtom, get(countAtom) + num)
);
```

`addNumberAtom`ã¯`numberAtom`ã®æ›´æ–°ã‚’è¡Œã†ã ã‘ã®Atomã§ã™ã€‚readé–¢æ•°ã‚’æŒãŸãš`countAtom`ãªã©ã®å€¤ã‚’èª­ã‚€ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ç”¨ã„ã¾ã™ã€‚

```tsx
const Component = () => {
  const setAddNumberAtom = useSetAtom(addNumberAtom);

  return (
    <button onClick={() => setAddNumberAtom(1)}>increment</button>
  )
}
```

ã“ã¡ã‚‰ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«`store`ã‚’ç”¨ã„ã¦ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```ts
test("should add 1", () => {
  const store = createStore();
  store.set(numberAtom, 1); // numberAtomã®åˆæœŸå€¤ã‚’è¨­å®š
  store.set(addNumberAtom, 1); // addNumberAtomã¨ãã®å¼•æ•°ã‚’æ¸¡ã™
  const newNumber = store.get(numberAtom); // æ›´æ–°ã•ã‚ŒãŸnumberAtomã®å€¤ã‚’èª­ã¿å‡ºã™

  expect(newNumber).toBe(2);
})
```

å¼•æ•°ã‚’å—ã‘å–ã‚‰ãªã„Write-only Atomã®å ´åˆã¯`set`ã§å¼•æ•°ã‚’æ¸¡ã•ãªãã¦å¤§ä¸ˆå¤«ã§ã™ã€‚

```ts
const incrementNumberAtom = atom(
  null,
  (get, set) => set(numberAtom, get(countAtom) + 1)
);

test("should add 1", () => {
  const store = createStore();
  store.set(numberAtom, 1);
  store.set(addNumberAtom); // å¼•æ•°ç„¡ã—ã§OK
  const newNumber = store.get(numberAtom);

  expect(newNumber).toBe(2);
})
```
