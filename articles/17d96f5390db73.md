---
title: "ç”»åƒã®ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ã‚ãšã«å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "javascript"]
published: false
---

Reactã‚’ä½¿ã£ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã§ç”»åƒã®ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã‚ã£ãŸã®ã§è¨˜äº‹åŒ–ã—ã¦ã¿ã¾ã™ã€‚

ã€ŒReact ç”»åƒ ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã€ã§æ¤œç´¢ã™ã‚‹ã¨å¤§ä½“`react-dropzone`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ãŸå®Ÿè£…æ–¹æ³•ãŒå¤šãå‡ºã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚ã“ã‚Œã‚’ä½¿ã£ã¦ã‚‚è‰¯ã„ã®ã§ã™ãŒã€ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’å‰Šã‚ŠãŸã„ã€ã›ã£ã‹ããªã‚‰ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆã«ã¤ã„ã¦å‹‰å¼·ã—ãŸã„ã€ã¨ã„ã†ã“ã¨ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã‚ãšã«å®Ÿè£…ã—ã¾ã—ãŸã€‚

https://react-dropzone.js.org/

# å‡ºæ¥ä¸ŠãŒã‚Šã‚¤ãƒ¡ãƒ¼ã‚¸

ä»¥ä¸‹ã®gifã®ã‚ˆã†ãªå®Ÿè£…ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/5258e893db9c-20230103.gif)
*ç”»åƒã¯ã„ã‚‰ã™ã¨ã‚„æ§˜ã‚ˆã‚Š*


# é–‹ç™ºã—ã¦ã¿ãŸ

å¤§ã¾ã‹ã«ã¯ä»¥ä¸‹ã®ã‚‚ã®ã‚’å®Ÿè£…ã™ã‚Œã°OKã§ã™ã€‚

- ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹é ˜åŸŸã‚’ä½œæˆã—ã€ãã“ã«ä»¥ä¸‹ã®ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²ã™ã‚‹
  - `dragenter`: ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸã‚‚ã®ãŒãã“ã«å…¥ã£ã¦ããŸã¨ãã«ä½•ã‚’ã™ã‚‹ã‹ï¼Ÿ
    - ä¾‹ï¼šãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®`opacity`ã‚’ä¸‹ã’ã‚‹
  - `dragleave`: ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸã‚‚ã®ãŒãã“ã‚’å‡ºã¦ã„ã£ãŸã¨ãã«ä½•ã‚’ã™ã‚‹ã‹ï¼Ÿ
    - ä¾‹ï¼šãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®`opacity`ã‚’å…ƒã«æˆ»ã™
  - `drop`: ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹ã‚‚ã®ã‚’ãã“ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸã¨ãã«ä½•ã‚’ã™ã‚‹ã‹ï¼Ÿ
    - ä¾‹ï¼šç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
- ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‰ãã®ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹

å„ã‚¤ãƒ™ãƒ³ãƒˆã®è©³ç´°ã¯ä»¥ä¸‹å‚ç…§

https://developer.mozilla.org/ja/docs/Web/API/DragEvent

## ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã

### â‘ ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹é ˜åŸŸã‚’ä½œæˆ

ã¾ãšã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ãŒã§ãã‚‹é ˜åŸŸã¨ã—ã¦ã€`DropImageZone`ã¨ã„ã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚

```tsx:src/DropImageZone.tsx
import { DragEvent, FC, ReactNode, useState } from "react";

type Props = {
  onDropFile: (file: File) => void;
  children: ReactNode;
};

const DropImageZone: FC<Props> = ({ onDropFile, children }) => {
  const [isDragActive, setIsDragActive] = useState<boolean>(false);

  const onDragEnter = (e: DragEvent<HTMLDivElement>) => {
    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {
      setIsDragActive(true);
    }
  };

  const onDragLeave = (e: DragEvent<HTMLDivElement>) => {
    setIsDragActive(false);
  };

  const onDrop = (e: DragEvent<HTMLDivElement>) => {
    e.preventDefault();
    setIsDragActive(false);
    if (e.dataTransfer.files !== null && e.dataTransfer.files.length > 0) {
      if (e.dataTransfer.files.length === 1) {
        onDropFile(e.dataTransfer.files[0]);
      } else {
        alert("ãƒ•ã‚¡ã‚¤ãƒ«ã¯ï¼‘å€‹ã¾ã§ï¼");
      }
      e.dataTransfer.clearData();
    }
  };

  return (
    <div
      onDragEnter={onDragEnter}
      onDragLeave={onDragLeave}
      onDragOver={(e) => e.preventDefault()}
      onDrop={onDrop}
      // mergeã¯classã‚’åˆæˆã™ã‚‹è‡ªä½œã®é–¢æ•°
      // DragãŒæœ‰åŠ¹ã®ã¨ãopacityã‚’å¤‰æ›´ã™ã‚‹
      className={merge(style.drop_zone, isDragActive ? style.opacity : null)}
    >
      {children}
    </div>
  );
};
```

Reactã®`div`è¦ç´ ã«`onDragEnter`ç­‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ãã‚Œã‚‰ã‚’ä¸€ã¤ãšã¤ã‚„ã£ã¦ã„ãã ã‘ã§ã™ã€‚å„ã‚¤ãƒ™ãƒ³ãƒˆã®å¼•æ•°ã®å‹ã¯`React.DragEvent<HTMLDivElement>`ã«ãªã‚Šã¾ã™ã€‚

`onDragEnter`ã¯`dragenter`ã‚¤ãƒ™ãƒ³ãƒˆã«ç›¸å½“ã—ã¾ã™ã€‚ã“ã“ã§ã¯ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹stateã§ã‚ã‚‹`isDragActive`ã‚’å¤‰æ›´ã•ã›ã¾ã™ã€‚ç”»åƒã‚’ï¼’å€‹ä»¥ä¸ŠåŒæ™‚ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã¯æƒ³å®šã—ã¦ãªã„ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®æ•°ãŒï¼‘å€‹ã§ãªã„ã¨ãã¯ç„¡åŠ¹ãªãƒ‰ãƒ©ãƒƒã‚°ã¨ã„ã†ã“ã¨ã§stateã¯å¤‰æ›´ã•ã›ã¾ã›ã‚“ã€‚

`onDragLeave`ã¯`dragleave`ã‚¤ãƒ™ãƒ³ãƒˆã«ç›¸å½“ã—ã¾ã™ã€‚ã“ã“ã§ã¯`onDragEnter`ã§å¤‰æ›´ã—ãŸstateã‚’å…ƒã«æˆ»ã—ã¦ã„ã¾ã™ã€‚

`onDragOver`ã¯`dragover`ã‚¤ãƒ™ãƒ³ãƒˆã«ç›¸å½“ã—ã¾ã™ã€‚ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã«ã™ã‚‹ã¹ãã“ã¨ã¯ç„¡ã„ã®ã§ã™ãŒã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã—ã¾ã†ã®ã§ãã‚Œã‚’`preventDefault`ã§é˜»æ­¢ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

`onDrop`ã¯`drop`ã‚¤ãƒ™ãƒ³ãƒˆã«ç›¸å½“ã—ã¾ã™ã€‚ã“ã“ã§ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒï¼‘å€‹ã ã‘ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã—ã€è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å—ã‘å–ã£ãŸ`onDropFile`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚`onDropFile`ã¯`File`å‹ã®å¼•æ•°ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚


:::message
ã‚‚ã¡ã‚ã‚“`onDrop`ç­‰ã‚’ä½¿ã‚ãšã«`addEventListener`ã‚’ä½¿ã£ã¦ã‚‚å®Ÿè£…ã™ã‚‹ã“ã¨ãŒãã¾ã™ã€‚ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```tsx
const ref = useRef<HTMLDivElement | null>(null);

const onDrop = (e: DragEvent) => {...};

useEffect(() => {
  ref.current.addEventListener('drop', onDrop);
  return ref.current.removeEventListener('drop', onDrop)
});

return (
  <div ref={ref}>
    ...
  </div>
)

```

Reactã‚’ä½¿ã£ãŸé–‹ç™ºã®å ´åˆã€`onDrag`ã§ã‚„ã£ãŸæ–¹ãŒå¤šãã®å ´åˆåŠ¹ç‡çš„ã§ã™ã®ã§ã‚ã–ã‚ã–ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ä½¿ã†å¿…è¦ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚ã—ã‹ã—ãƒãƒƒãƒˆã§æ¤œç´¢ã—ãŸã¨ãã«ãã®ã‚ˆã†ãªå®Ÿè£…ä¾‹ãŒå¤šããƒ’ãƒƒãƒˆã—ãŸã®ã§ä¸€å¿œè¨˜è¼‰ã—ã¦ãŠãã¾ã™ã€‚

ã“ã“ã§æ³¨æ„ã™ã‚‹ç‚¹ã¨ã—ã¦ã€ãƒãƒ³ãƒ‰ãƒ©ã®å¼•æ•°ã®å‹ãŒ`React.DragEvent`ã§ã¯ãªã`DragEvent`ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã‚¨ãƒ‡ã‚£ã‚¿ã®å…¥åŠ›ã‚µãƒãƒ¼ãƒˆã‚’ä½¿ã£ã¦ã„ã‚‹ã¨å‹æ‰‹ã«`React.DragEvent`ã®æ–¹ã‚’importã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ã®ã§æ³¨æ„ã—ã¾ã—ã‚‡ã†ï¼ˆè‡ªåˆ†ã¯ãã“ã§ãƒãƒã£ã¦ã—ã¾ã„ã¾ã—ãŸï¼‰ã€‚
:::

### â‘¡ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚ã¨ã®å‡¦ç†ã‚’è¨˜è¿°

ä¸Šè¨˜ã§ç”»åƒã®ãƒ‰ãƒ­ãƒƒãƒ—ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã‚ã¨ã¯ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‰ãã‚Œã‚’è¡¨ç¤ºã™ã‚‹ã ã‘ã§ã™ã€‚

```tsx:src/index.tsx
import { FC, useState } from "react";
import Image from "next/image";

const RegisterCard: FC = () => {
  const [image, setImage] = useState<string | null>(null);

  const onDropFile = (file: File) => {
    if (file.type.substring(0, 5) !== "image") {
      alert("ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã§ãªã„ã‚‚ã®ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã›ã‚“ï¼");
    } else {
      const fileReader = new FileReader();
      fileReader.onload = () => {
        const imageSrc: string = fileReader.result as string;
        setImage(imageSrc);
      };
      fileReader.readAsDataURL(file);
    }
  };

  return (
    <div className={style.container}>
      {image ? (
        <Image
          src={image}
          width={403}
          height={598}
          alt="ç”»åƒã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"
          className={style.preview_image}
        />
      ) : (
        <DropImageZone onDropFile={onDropFile}>
          <div className={style.content}>
            <Image
              src={"/file-upload.svg"}
              width={24}
              height={24}
              alt="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³"
            />
          </div>
        </DropImageZone>
      )}
    </div>
  );
};
```

ç”»åƒã‚’stateã¨ã—ã¦ãã‚ŒãŒ`null`ã®ã¨ãï¼ˆç”»åƒãŒã¾ã ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã„ã¨ãï¼‰ã¯`DropImageZone`ã‚’è¡¨ç¤ºã€ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‰ãã®ç”»åƒã‚’ãã®ã¾ã¾è¡¨ç¤ºã—ã¾ã™ã€‚

ç”»åƒã¯æœ€åˆ`File`å‹ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€`FileReader`ã§èª­ã¿è¾¼ã‚“ã ã‚‚ã®ã‚’ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã§ãã®ãƒ‘ã‚¹ã‚’`string`å‹ã§å—ã‘å–ã‚Šã¾ã™ã€‚èª­ã¿è¾¼ã‚€éš›ã«Fileã®MIMEå‹ã‚’è¦‹ã¦ç”»åƒã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ï¼ˆMIMEã®æœ€åˆãŒ`image`ã§ã‚ã‚Œã°ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¨åˆ¤å®šã§ãã‚‹ï¼‰ã€‚

https://developer.mozilla.org/ja/docs/Web/API/FileReader

# ãŠã¾ã‘ï¼š ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã§ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚‚å®Ÿè£…ã™ã‚‹

å¤šãã®å ´åˆã€ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã ã‘ã§ãªããƒ•ã‚¡ã‚¤ãƒ«é¸æŠã§ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚‚ã‚ã‚ã›ã¦å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã€ãã¡ã‚‰ã®å®Ÿè£…ã‚‚åˆã‚ã›ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

ã“ã¡ã‚‰ã®å®Ÿè£…ã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã‚ˆã‚Šã‚‚ç°¡å˜ã§ã€ã‚·ãƒ³ãƒ—ãƒ«ã«`input`è¦ç´ ã‚’ä½¿ã£ã¦å®Ÿè£…ã™ã‚‹ã ã‘ã§ã™ã€‚ç§ã¯`InputImageSelector`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¦ã¿ã¾ã—ãŸã€‚

```tsx:src/InputImageSelector.tsx
import { ChangeEvent, FC } from "react";

type Props = {
  onDropFile: (file: File) => void;
};

const InputImageSelector: FC<Props> = ({ onDropFile }) => {
  const onChange = (e: ChangeEvent<HTMLInputElement>) => {
    e.preventDefault();
    const files = e.target.files;
    if (files !== null && files.length > 0) {
      if (files.length === 1) {
        onDropFile(files[0]);
      } else {
        alert("ãƒ•ã‚¡ã‚¤ãƒ«ã¯ï¼‘å€‹ã¾ã§ï¼");
      }
    }
  };

  return (
    <label htmlFor="image" className={style.input_image}>
      <input type="file" id="image" accept="image/*" onChange={onChange} />
      browse
    </label>
  );
};
```

`input`è¦ç´ ã«`onChange`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²ã—ã¾ã™ã€‚ã¾ãŸã€ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã¿ã‚’æƒ³å®šã—ã¦ã„ã‚‹ãŸã‚ã€`accept`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«`image/*`ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

ã‚ã¨ã¯å…ˆç¨‹ã®`DropImageZone`ã¨çµ„ã¿åˆã‚ã›ã‚‹ã ã‘ã§ã™ã€‚

```tsx:src/index.tsx
...

return (
  <div className={style.container}>
    {image ? (
      <Image
        src={image}
        width={403}
        height={598}
        alt="ç”»åƒã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"
        className={style.preview_image}
      />
    ) : (
      <DropImageZone onDropFile={onDropFile}>
        <div className={style.content}>
          <Image
            src={"/file-upload.svg"}
            width={24}
            height={24}
            alt="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³"
          />
        </div>
        <div className={style.message}>
          Drop files to upload or&nbsp;
          <InputImageSelector onDropFile={onDropFile} />
        </div>
      </DropImageZone>
    )}
  </div>
);
```
